<!DOCTYPE html>
<html>
	    <head>

        <meta charset="utf-8" />

    	<!-- Fonts -->
    	<link rel="stylesheet" type="text/css" href="https://plot.ly/gh-pages/documentation/static//fonts/font-awesome/css/font-awesome.min.css" />
        <link rel="stylesheet" type="text/css" href="https://plot.ly/gh-pages/documentation/static//css/plotly_icons.css" />
        <link href="//fonts.googleapis.com/css?family=Open+Sans:600,400,300,200|Inconsolata|Ubuntu+Mono:400,700" rel="stylesheet" type="text/css" />


    	<!-- Stytlesheets -->
    	<link rel="stylesheet" type="text/css" href="https://plot.ly/gh-pages/documentation/static//css/normalize.css">
    	<link rel="stylesheet" type="text/css" href="https://plot.ly/gh-pages/documentation/static//css/base.css">
    	<link rel="stylesheet" type="text/css" href="https://plot.ly/gh-pages/documentation/static//css/layout_block.css">
    	<link rel="stylesheet" type="text/css" href="https://plot.ly/gh-pages/documentation/static//css/modules.css">
    	<link rel="stylesheet" type="text/css" href="https://plot.ly/gh-pages/documentation/static//css/state.css">
    	<!-- Download icon for Plotly.js -->
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        
        <link rel="stylesheet" type="text/css" href="https://plot.ly/gh-pages/documentation/static//css/api_docs.css">
        

    	<!-- Icon -->
    	<link rel="shortcut icon" href="https://plot.ly/gh-pages/documentation/static//images/plotly-ico.png" type="image/x-icon" />

    	<!-- META TAGS -->
    	<!-- SEO Tags - title, meta_description -->
    <title>User Guide</title>
    <meta name="description" content="UseR Guide for plotly and its R and ggplot2 API Libraries.">

<!-- Bing tags -->
    <meta name="msvalidate.01" content="D319859A832F9F1D15A7646E2A42150A" />
<!-- Facebook tags -->
    <meta property="og:title" content="Plotly UseR Guide"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://plot.ly/gh-pages/documentation/static//images/static-image.png">
    <meta property="og:description" content="UseR Guide for plotly and its R and ggplot2 API Libraries."/>
    <meta property="og:url" />
    <meta property="fb:admins" content="1123751525"/>
    <meta property="fb:admins" content="22418"/>

<!-- twitter tags -->
    <meta name="twitter:card" content="photo" />
    <meta name="twitter:title" content="Plotly UseR Guide"/>
    <meta name="twitter:url" content="http://help.plot.lyr/user-guide/"/>
    <meta name="twitter:description" content="UseR Guide for plotly and its R and ggplot2 API Libraries."/>
    <meta name="twitter:image" content="https://plot.ly/gh-pages/documentation/static//images/static-image.png">
    <meta name="twitter:site" content="@plotlygraphs"/>

<!-- Favicon -->
    <link rel="shortcut icon" href="https://plot.ly/gh-pages/documentation/static//images/plotly-ico.png" />



    	<!-- code highlighting -->
    	<link rel="stylesheet" href="https://plot.ly/gh-pages/documentation/static//javascripts/codehighlight/styles/tomorrow.css">

	<!-- start Mixpanel --><script type="text/javascript">(function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
	for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);
	mixpanel.init("ad6df61d0b9400400b240631576c24d4");</script><!-- end Mixpanel -->

	</head>

	<head>
	<link rel="stylesheet" type="text/css" href="https://plot.ly/gh-pages/documentation/static//css/state.css">
	<link rel="stylesheet" type="text/css" href="https://plot.ly/gh-pages/documentation/static//css/ipython-notebook-base.css">
	<link rel="stylesheet" type="text/css" href="https://plot.ly/gh-pages/documentation/static//css/ipython-notebook-custom.css">
	</head>

	<body>
		<div class="allcontent">
			<div class="headerbar">

    <div class="headerbar-leftside">
        <a href="https://plot.ly/feed/" class="logo">
            <i class="ploticon-plotlylogo"></i> 
            <em>plotly</em>
        </a>
    </div>

  <div class="headerbar-rightside hidesmall">

      
      <a class="button"
         href="https://plot.ly/plot"
         target="_self">
          NEW PROJECT
      </a>
  </div>

  <div class="headerbar-nav hidesmall">
      <a href="https://plot.ly/plot" class="link --headerbar" target="_self">
      <span class="headerbar-nav-item ">Workspace</span>
      </a>
  
      <a href="https://plot.ly/feed/" class="link --headerbar" target="_self">
      <span class="headerbar-nav-item ">Explore</span>
      </a>
  
      <a href="https://plot.ly/api/" class="link --headerbar" target="_self">
      <span class="headerbar-nav-item ">API</span>
      </a>
  
      <a href="https://plot.ly/product/enterprise/" class="link --headerbar" target="_blank">
      <span class="headerbar-nav-item ">Enterprise</span>
      </a>
  </div>
  
  <div class="hamburger">
		<a href='#popmenufull' onclick='return clickfullmenu();'>
			<img src="http://i.imgur.com/o7Mxj6T.png" alt="Menu" id="hamburgerlink" onmouseover="this.src='http://i.imgur.com/gj2TtuI.png'" onmouseout="this.src='http://i.imgur.com/o7Mxj6T.png'">
		</a>
		
	</div>

</div>

<!-- POP UP MENU -->
	<div id="popmenufull" style="display:none;">	 
			<div class="popupheader">
					<div class="headerbar-leftside">
						<a href="/feed/" class="logo">
							<i class="ploticon-plotlylogo"></i>
							<em>plotly</em>
						</a>
					</div>


					
					<a href='#popmenufull' onclick='return clickfullmenu();'>
					<div class="close"><img alt="close" src="http://i.imgur.com/esVZHwn.png"></div> </a>
			</div>	
						
			<div class="popupmenu">
				<ul>
					<li><a href="https://plot.ly/plot">Workspace</a></li>
					<li><a href="https://plot.ly/feed/">Explore</a></li>
					<li><a href="https://plot.ly/api/">API</a></li>
					<li><a href="https://plot.ly/product/enterprise/">Enterprise</a></li>
				</ul>
			</div>

	</div>

  <!-- POPUP MENU FULL PAGE -->
	<script>
		function clickfullmenu(){
			var thediv=document.getElementById('popmenufull');
			if(thediv.style.display == "none"){
				thediv.style.display = "";
			}else{
				thediv.style.display = "none";
			}
			return false;
				}
	</script>

	
<div style="
    	background-image: url(https://plot.ly/gh-pages/documentation/static//images/banner-bar.png);
    	height: 256px; 
    	text-align: center;">
	<div style="background-color: rgba(0,0,0,0.6); height: 100%; text-align: center;"></div>
</div>

	<div class="navigation-bar">

    <p class="align-left padding_left_small"><a href="/api/">API Libraries</a><span>/</span><a href="/r"  >R</a><span>/</span><a href="#">Plotly UseR Guide</a></p>

    <div class="float-right padding_right_small" style="margin-top:10px;">
        <a id="forklink" href="https://github.com/plotly"><i class="fa fa-github-alt"></i> Fork on GitHub</a>
    </div>

</div>



			<div class="sectionseparator_white">
				<div class="container">

					
<div style="text-align: center;position: relative;top: -285px;">
	<h2 class="centered" style="color: white;margin-bottom: 20px;">use plotly offline</h2>

	<h5 style="color: white;">download for RStudio and Shiny
	 for $249</h5>

	<a class="button" href="http://purchasing.plot.ly/plotly-offline-r
	" target="_blank" style="text-decoration: none;font-size: 14px;display: inline-block;padding: 12px 24px;">DOWNLOAD</a>
</div>



					<h1>Plotly UseR Guide</h1>

<p>Version 1.0.0 of the <a href="https://github.com/ropensci/plotly">plotly R package</a> introduces a new high-level interface for working with plotly&#39;s JavaScript graphing library from R. The aim of this vignette is to explain the semantics of this interface, but I also recommend perusing <a href="https://plot.ly/r/">plotly&#39;s R homepage</a> for more examples.</p>

<p>To initiate a plotly object, use <code>plot_ly()</code>. Here we turn the <code>economics</code> data frame (from the ggplot2 package) into a plotly visualization and store it as the object <code>p</code>.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>plotly<span class="p">)</span>
p <span class="o">&lt;-</span> plot_ly<span class="p">(</span>economics<span class="p">,</span> x <span class="o">=</span> <span class="kp">date</span><span class="p">,</span> y <span class="o">=</span> uempmed<span class="p">)</span>
</code></pre></div>
<p>If you have a plotly account, printing plotly objects in the R console will create a new plotly figure, and open it in your web browser. If you&#39;re using knitr/R Markdown with HTML output (like <a href="https://github.com/ropensci/plotly/tree/master/vignettes/intro.Rmd">this vignette</a>), printing not only creates the plot, but also embeds it as an HTML iframe.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">p
</code></pre></div>
<iframe height="600" id="igraph" scrolling="no" seamless="seamless" src="https://plot.ly/~RPlotBot/997.embed" width="800" frameBorder="0"></iframe>

<p><code>plot_ly()</code> has a number of arguments which are unique to the R package and make common visualizations a bit easier. These arguments are very much inspired by the semantics of ggplot2&#39;s <code>qplot()</code> in the sense that a scales are automatically applied these variables (i.e., they map data to visual properties).</p>

<h4>Qualitative color mappings</h4>

<p>If a ordinal variable (aka a non-ordered factor variable) is assigned to color, then a qualitative color palette is used by default.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">plot_ly<span class="p">(</span>iris<span class="p">,</span> x <span class="o">=</span> Petal.Length<span class="p">,</span> y <span class="o">=</span> Petal.Width<span class="p">,</span>
        color <span class="o">=</span> Species<span class="p">,</span> mode <span class="o">=</span> <span class="s">&quot;markers&quot;</span><span class="p">)</span>
</code></pre></div>
<iframe height="600" id="igraph" scrolling="no" seamless="seamless" src="https://plot.ly/~RPlotBot/999.embed" width="800" frameBorder="0"></iframe>

<p>If you want to change the default palette, it&#39;s recommended that you provide a <a href="http://colorbrewer2.org">http://colorbrewer2.org</a> qualitative pallette name (e.g., &quot;Set1&quot; or &quot;Accent&quot;) to the colors argument.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">plot_ly<span class="p">(</span>iris<span class="p">,</span> x <span class="o">=</span> Petal.Length<span class="p">,</span> y <span class="o">=</span> Petal.Width<span class="p">,</span>
        color <span class="o">=</span> Species<span class="p">,</span> colors <span class="o">=</span> <span class="s">&quot;Set1&quot;</span><span class="p">,</span> mode <span class="o">=</span> <span class="s">&quot;markers&quot;</span><span class="p">)</span>
</code></pre></div>
<iframe height="600" id="igraph" scrolling="no" seamless="seamless" src="https://plot.ly/~RPlotBot/1001.embed" width="800" frameBorder="0"></iframe>

<p>In this case, the palette consists of 9 colors and the default behavior is to pick colors that are furthest apart (&quot;#E41A1C&quot;, &quot;#FF7F00&quot;, and &quot;#999999&quot;).</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">cols <span class="o">&lt;-</span> RColorBrewer<span class="o">::</span>brewer.pal<span class="p">(</span><span class="m">9</span><span class="p">,</span> <span class="s">&quot;Set1&quot;</span><span class="p">)</span>
scales<span class="o">::</span>show_col<span class="p">(</span>cols<span class="p">)</span>
</code></pre></div>
<div align="center">
  <a href="http://imgur.com/PpLch1T">
    <img src="http://i.imgur.com/PpLch1T.png" />
  </a>
</div>

<p>If you&#39;d like more control over the mapping, you can provide a vector of colors (of appropriate length).</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">cols <span class="o">&lt;-</span> RColorBrewer<span class="o">::</span>brewer.pal<span class="p">(</span><span class="kp">nlevels</span><span class="p">(</span>iris<span class="o">$</span>Species<span class="p">),</span> <span class="s">&quot;Set1&quot;</span><span class="p">)</span>
plot_ly<span class="p">(</span>iris<span class="p">,</span> x <span class="o">=</span> Petal.Length<span class="p">,</span> y <span class="o">=</span> Petal.Width<span class="p">,</span>
        color <span class="o">=</span> Species<span class="p">,</span> colors <span class="o">=</span> cols<span class="p">,</span> mode <span class="o">=</span> <span class="s">&quot;markers&quot;</span><span class="p">)</span>
</code></pre></div>
<iframe height="600" id="igraph" scrolling="no" seamless="seamless" src="https://plot.ly/~RPlotBot/1003.embed" width="800" frameBorder="0"></iframe>

<h4>Sequential color mappings</h4>

<p>If either a numeric or an ordered factor is mapped to color, <code>plot_ly()</code> applies a sequential color scale by default.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">plot_ly<span class="p">(</span>iris<span class="p">,</span> x <span class="o">=</span> Petal.Length<span class="p">,</span> y <span class="o">=</span> Petal.Width<span class="p">,</span>
        color <span class="o">=</span> <span class="kp">as.ordered</span><span class="p">(</span>Species<span class="p">),</span> mode <span class="o">=</span> <span class="s">&quot;markers&quot;</span><span class="p">)</span>
</code></pre></div>
<iframe height="600" id="igraph" scrolling="no" seamless="seamless" src="https://plot.ly/~RPlotBot/1005.embed" width="800" frameBorder="0"></iframe>

<p>In the case of continuous numeric variables, <code>plot_ly()</code> performs a linear mapping between the data and an interpolated color pallette.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">plot_ly<span class="p">(</span>iris<span class="p">,</span> x <span class="o">=</span> Petal.Length<span class="p">,</span> y <span class="o">=</span> Petal.Width<span class="p">,</span>
        color <span class="o">=</span> Sepal.Length<span class="p">,</span> mode <span class="o">=</span> <span class="s">&quot;markers&quot;</span><span class="p">)</span>
</code></pre></div>
<iframe height="600" id="igraph" scrolling="no" seamless="seamless" src="https://plot.ly/~RPlotBot/1007.embed" width="800" frameBorder="0"></iframe>

<p>The colors argument takes arbitrary color codes of arbitrary length. Here is how we could use it to replicate the default mapping in ggplot2.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">plot_ly<span class="p">(</span>iris<span class="p">,</span> x <span class="o">=</span> Petal.Length<span class="p">,</span> y <span class="o">=</span> Petal.Width<span class="p">,</span>
        color <span class="o">=</span> Sepal.Length<span class="p">,</span> colors <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;#132B43&quot;</span><span class="p">,</span> <span class="s">&quot;#56B1F7&quot;</span><span class="p">),</span>
        mode <span class="o">=</span> <span class="s">&quot;markers&quot;</span><span class="p">)</span>
</code></pre></div>
<iframe height="600" id="igraph" scrolling="no" seamless="seamless" src="https://plot.ly/~RPlotBot/1009.embed" width="800" frameBorder="0"></iframe>

<h4>Diverging color mappings</h4>

<p>To obtain a diverging color mapping, just provide a diverging palette to the colors argument.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">plot_ly<span class="p">(</span>iris<span class="p">,</span> x <span class="o">=</span> Petal.Length<span class="p">,</span> y <span class="o">=</span> Petal.Width<span class="p">,</span>
        color <span class="o">=</span> Sepal.Length<span class="p">,</span> colors <span class="o">=</span> <span class="s">&quot;PuOr&quot;</span><span class="p">,</span> mode <span class="o">=</span> <span class="s">&quot;markers&quot;</span><span class="p">)</span>
</code></pre></div>
<iframe height="600" id="igraph" scrolling="no" seamless="seamless" src="https://plot.ly/~RPlotBot/1011.embed" width="800" frameBorder="0"></iframe>

<h4>The symbol argument</h4>

<p>To encode values using symbols, use the symbol argument.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">plot_ly<span class="p">(</span>iris<span class="p">,</span> x <span class="o">=</span> Petal.Length<span class="p">,</span> y <span class="o">=</span> Petal.Width<span class="p">,</span>
        symbol <span class="o">=</span> Species<span class="p">,</span> mode <span class="o">=</span> <span class="s">&quot;markers&quot;</span><span class="p">)</span>
</code></pre></div>
<iframe height="600" id="igraph" scrolling="no" seamless="seamless" src="https://plot.ly/~RPlotBot/1013.embed" width="800" frameBorder="0"></iframe>

<p>To change the default symbols used, use the symbols argument. <a href="https://plot.ly/r/reference/#marker">View all of the available symbol</a>.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">plot_ly<span class="p">(</span>iris<span class="p">,</span> x <span class="o">=</span> Petal.Length<span class="p">,</span> y <span class="o">=</span> Petal.Width<span class="p">,</span> mode <span class="o">=</span> <span class="s">&quot;markers&quot;</span><span class="p">,</span>
        symbol <span class="o">=</span> Species<span class="p">,</span> symbols <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;cross&quot;</span><span class="p">,</span> <span class="s">&quot;square&quot;</span><span class="p">,</span> <span class="s">&quot;triangle-down&quot;</span><span class="p">))</span>
</code></pre></div>
<iframe height="600" id="igraph" scrolling="no" seamless="seamless" src="https://plot.ly/~RPlotBot/1015.embed" width="800" frameBorder="0"></iframe>

<h3>The group argument and <code>subplot()</code></h3>

<p>Using the group argument splits the data into different plotly &quot;traces&quot;.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">plot_ly<span class="p">(</span>iris<span class="p">,</span> x <span class="o">=</span> Petal.Length<span class="p">,</span> y <span class="o">=</span> Petal.Width<span class="p">,</span>
        group <span class="o">=</span> Species<span class="p">,</span> mode <span class="o">=</span> <span class="s">&quot;markers&quot;</span><span class="p">)</span>
</code></pre></div>
<iframe height="600" id="igraph" scrolling="no" seamless="seamless" src="https://plot.ly/~RPlotBot/1017.embed" width="800" frameBorder="0"></iframe>

<p>Although we haven&#39;t specified a coloring scheme, plotly will employ one on it&#39;s own default scheme. The group argument is quite powerful when used in conjunction with <code>subplot()</code> in order to anchor traces onto different axes.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">iris<span class="o">$</span>id <span class="o">&lt;-</span> <span class="kp">as.integer</span><span class="p">(</span>iris<span class="o">$</span>Species<span class="p">)</span>
p <span class="o">&lt;-</span> plot_ly<span class="p">(</span>iris<span class="p">,</span> x <span class="o">=</span> Petal.Length<span class="p">,</span> y <span class="o">=</span> Petal.Width<span class="p">,</span> group <span class="o">=</span> Species<span class="p">,</span>
             xaxis <span class="o">=</span> <span class="kp">paste0</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> id<span class="p">),</span> mode <span class="o">=</span> <span class="s">&quot;markers&quot;</span><span class="p">)</span>
subplot<span class="p">(</span>p<span class="p">)</span>
</code></pre></div>
<iframe height="600" id="igraph" scrolling="no" seamless="seamless" src="https://plot.ly/~RPlotBot/1019.embed" width="800" frameBorder="0"></iframe>

<p>Since <code>subplot()</code> does not assume x/y axes are on a common scale, it does not impose any restrictions on the range by default. However, you can change this by pre-specifying the range of the <a href="https://plot.ly/r/reference/#xaxis">axis objects</a> via the <code>layout()</code> function.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">p2 <span class="o">&lt;-</span> layout<span class="p">(</span>
  p<span class="p">,</span>
  xaxis <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>range <span class="o">=</span> <span class="kp">range</span><span class="p">(</span>Petal.Length<span class="p">)</span> <span class="o">+</span> <span class="kt">c</span><span class="p">(</span><span class="m">-0.1</span><span class="p">,</span> <span class="m">0.1</span><span class="p">)),</span>
  yaxis <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>range <span class="o">=</span> <span class="kp">range</span><span class="p">(</span>Petal.Width<span class="p">)</span> <span class="o">+</span> <span class="kt">c</span><span class="p">(</span><span class="m">-0.1</span><span class="p">,</span> <span class="m">0.1</span><span class="p">))</span>
<span class="p">)</span>
subplot<span class="p">(</span>p2<span class="p">)</span>
</code></pre></div>
<iframe height="600" id="igraph" scrolling="no" seamless="seamless" src="https://plot.ly/~RPlotBot/1021.embed" width="800" frameBorder="0"></iframe>

<p>The <code>subplot()</code> function creates &quot;xaxis[0-9]&quot; objects which inherit pre-specified properties, but you can also customize each subplot by referencing these objects in the layout</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">layout<span class="p">(</span>
    subplot<span class="p">(</span>p2<span class="p">),</span>
    yaxis2 <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>title <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
    yaxis3 <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>title <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<iframe height="600" id="igraph" scrolling="no" seamless="seamless" src="https://plot.ly/~RPlotBot/1023.embed" width="800" frameBorder="0"></iframe>

<p><a href="https://plot.ly/r/map-subplots-and-small-multiples/">See here</a> for another example of using the group argument to make small multiples (with maps!).</p>

<h3>Manually adding traces</h3>

<p>Sometimes you may want multiple traces on a plot, but have different traces from different data sources. In this case, the <code>add_trace()</code> function and it&#39;s (optional) <code>data</code> argument come in handy.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">m <span class="o">&lt;-</span> loess<span class="p">(</span>uempmed <span class="o">~</span> <span class="kp">as.numeric</span><span class="p">(</span><span class="kp">date</span><span class="p">),</span> economics<span class="p">)</span>
efit <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>date <span class="o">=</span> economics<span class="o">$</span><span class="kp">date</span><span class="p">,</span> yhat <span class="o">=</span> fitted<span class="p">(</span>m<span class="p">))</span>

plot_ly<span class="p">(</span>economics<span class="p">,</span> x <span class="o">=</span> <span class="kp">date</span><span class="p">,</span> y <span class="o">=</span> uempmed<span class="p">,</span> name <span class="o">=</span> <span class="s">&quot;observed&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  add_trace<span class="p">(</span>y <span class="o">=</span> yhat<span class="p">,</span> name <span class="o">=</span> <span class="s">&quot;estimated&quot;</span><span class="p">,</span> data <span class="o">=</span> efit<span class="p">)</span>
</code></pre></div>
<iframe height="600" id="igraph" scrolling="no" seamless="seamless" src="https://plot.ly/~RPlotBot/1025.embed" width="800" frameBorder="0"></iframe>

<p>Note that the date information carries over from the first trace to the second. In fact, by default, information from the first trace carries over to all subsequent traces unless the property is overwritten or if we set <code>inherit = FALSE</code> in <code>plot_ly()</code> (this helps <a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself">avoid repeating yourself</a>).</p>

<h3>Mixing data manipulation and visualization verbs</h3>

<p>If you look at the structure of plotly objects, they are actually data frames with a class of plotly and a special environment attached (this environment tracks the mapping from data to visual properties).</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">str<span class="p">(</span>p <span class="o">&lt;-</span> plot_ly<span class="p">(</span>economics<span class="p">,</span> x <span class="o">=</span> <span class="kp">date</span><span class="p">,</span> y <span class="o">=</span> uempmed<span class="p">))</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">## Classes &#39;plotly&#39; and &#39;data.frame&#39;:   478 obs. of  6 variables:
##  $ date    : Date, format: &quot;1967-06-30&quot; &quot;1967-07-31&quot; ...
##  $ pce     : num  508 511 517 513 518 ...
##  $ pop     : int  198712 198911 199113 199311 199498 199657 199808 199920 200056 200208 ...
##  $ psavert : num  9.8 9.8 9 9.8 9.7 9.4 9 9.5 8.9 9.6 ...
##  $ uempmed : num  4.5 4.7 4.6 4.9 4.7 4.8 5.1 4.5 4.1 4.6 ...
##  $ unemploy: int  2944 2945 2958 3143 3066 3018 2878 3001 2877 2709 ...
##  - attr(*, &quot;plotly_hash&quot;)= chr &quot;7ff330ec8c566561765c62cbafed3e0f#19&quot;
</code></pre></div>
<p>Doing this allows us to mix data manipulation and visualization verbs in a <a href="https://dl.dropboxusercontent.com/u/41902/pipe-dsls.pdf">pure(ly) functional, predictable and pipeable</a> manner. Here, we take advantage of <a href="http://cran.r-project.org/web/packages/dplyr/index.html">dplyr</a>&#39;s <code>filter()</code> verb to label the highest peak in the time series:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">p <span class="o">%&gt;%</span>
  add_trace<span class="p">(</span>y <span class="o">=</span> fitted<span class="p">(</span>loess<span class="p">(</span>uempmed <span class="o">~</span> <span class="kp">as.numeric</span><span class="p">(</span><span class="kp">date</span><span class="p">))))</span> <span class="o">%&gt;%</span>
  layout<span class="p">(</span>title <span class="o">=</span> <span class="s">&quot;Median duration of unemployment (in weeks)&quot;</span><span class="p">,</span>
         showlegend <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">%&gt;%</span>
  dplyr<span class="o">::</span>filter<span class="p">(</span>uempmed <span class="o">==</span> <span class="kp">max</span><span class="p">(</span>uempmed<span class="p">))</span> <span class="o">%&gt;%</span>
  layout<span class="p">(</span>annotations <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>x <span class="o">=</span> <span class="kp">date</span><span class="p">,</span> y <span class="o">=</span> uempmed<span class="p">,</span> text <span class="o">=</span> <span class="s">&quot;Peak&quot;</span><span class="p">,</span> showarrow <span class="o">=</span> <span class="bp">T</span><span class="p">))</span>
</code></pre></div>
<iframe height="600" id="igraph" scrolling="no" seamless="seamless" src="https://plot.ly/~RPlotBot/1027.embed" width="800" frameBorder="0"></iframe>

<p>Although data frames can be thought of as the central object in this package, plotly visualizations don&#39;t actually <em>require</em> a data frame. This makes chart types that accept a <code>z</code> argument especially easy to use if you have a numeric matrix:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">plot_ly<span class="p">(</span>z <span class="o">=</span> volcano<span class="p">,</span> type <span class="o">=</span> <span class="s">&quot;surface&quot;</span><span class="p">)</span>
</code></pre></div>
<iframe height="600" id="igraph" scrolling="no" seamless="seamless" src="https://plot.ly/~RPlotBot/1029.embed" width="800" frameBorder="0"></iframe>


				</div>
			</div>
		</div>
    <footer>
<div class="plotly-footer">
	<div class="row footerarea footer-top">
		<div class="one column footcolumn space"> </div>
		<div class="two columns footcolumn respfooter">
			<h6 class="footer-heading">API</h6>
			<ul>
				<li><a  href="https://plot.ly/api/" target="_self">Documentation</a></li>
				<li><a  href="https://plot.ly/api/" target="_self">API Libraries</a></li>
				<li><a  href="https://plot.ly/rest/" target="_self">REST APIs</a></li>
				<li><a  href="https://plot.ly/javascript-graphing-library/" target="_self">Plotly.js</a></li>
				<li><a  href="https://plot.ly/workshop/" target="_self">Hardware</a></li>
			</ul>
		</div>
		<div class="two columns footcolumn respfooter">
			<h6 class="footer-heading">About Us</h6>
			<ul>
				<li><a href="https://plot.ly/company/team/" target="_self">Team</a></li>
				<li><a href="https://plot.ly/company/jobs/" target="_self">Careers</a></li>
				<li><a href="http://blog.plot.ly" target="_blank">Plotly Blog</a></li>
				<li><a href="http://moderndata.plot.ly" target="_blank">Modern Data</a></li>
			</ul>
		</div>
		<div class="two columns footcolumn respfooter">
			<h6 class="footer-heading">Help</h6>
			<ul>
				<li><a href="https://plot.ly/learn/" target="_self">Knowledge Base</a></li>
				<li><a href="https://plot.ly/benchmarks/" target="_self">Benchmarks</a></li>
				<li><a href="https://plot.ly/workshop/" target="_self">Workshop</a></li>
			</ul>
		</div>
		<div class="two columns footcolumn respfooter">
			<h6 class="footer-heading">Solutions</h6>
			<ul>
				<li><a href="https://plot.ly/product/plans/" target="_self">Plans &amp; Pricing</a></li>
				<li><a href="https://plot.ly/product/enterprise/" target="_self">Enterprise</a></li>
				<li><a href="https://plot.ly/online-graphing-and-statistics-for-educators/" target="_self">Education</a></li>
				<li><a href="https://plot.ly/product/plotlyjs/" target="_self">Plotly.js</a></li>
			</ul>
		</div>
		<div class="two columns footcolumn respfooter">	
     		<h6 class="footer-heading">Connect</h6>
			<ul class="plotly-social-media-small">
				<li><a href="//twitter.com/plotlygraphs" target="_blank"><i class="icon-twitter social_icon"></i></a></li>
				<li><a href="//www.facebook.com/Plotly" target="_blank"><i class="icon-facebook social_icon"></i></a></li>
				<li><a href="//github.com/plotly" target="_blank"><i class="icon-github social_icon"></i></a></li>
				<li><a href="//linkedin.com/company/plotly" target="_blank"><i class="icon-linkedin social_icon"></i></a></li>
				<li><a href="//plus.google.com/+PlotLy" target="_blank"><i class="icon-google-plus  social_icon"></i></a></li>
			</ul>
		</div>
		<div class="one column footcolumn"></div>
	</div>
	
	<div class="row footerarea footer-bottom">
		<div class="one column footcolumn space"> </div>
		<div class="four columns footcolumn"><p>Copyright &copy; 2015 Plotly. All rights reserved.</p></div>
		<div class="two columns footcolumn"><a href="https://plot.ly/terms-of-service/" target="_blank" ><p>Terms of Service</p></a></div>
		<div class="two columns footcolumn"><a href="https://plot.ly/privacy/" target="_blank"><p>Privacy Policy</p></a></div>
		
		
	</div>
</div>
</footer>


<script type='text/x-mathjax-config'>
MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']], processEscapes: true}});
</script>

<script type='text/javascript' src='//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML%2CSafe.js&#038;ver=4.1'></script>

	<!-- Image Hover Script -->
  	<script src="https://plot.ly/gh-pages/documentation/static//javascripts/imghover.js"></script>
	
	<!-- code highlighting -->
	<script src="https://plot.ly/gh-pages/documentation/static//javascripts/codehighlight/highlight.pack.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>



	</body>
</html>
